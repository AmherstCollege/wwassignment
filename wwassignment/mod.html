<!-- This page defines the form to create or edit an instance of this module -->
<!-- It is used from /course/mod.php.  The whole instance is available as $form. -->

<?php
// $Id$

// initial RPC experiment... not working out too well. i get completely
// unenlightening "invalid argument" error.

//	require_once 'XML/RPC.php';
//	
//	$msg = new XML_RPC_Message('WeBWorK.RPC.CourseManagement.listCourses');
//	$cli = new XML_RPC_Client('/webwork2_rpc', 'https://devel.webwork.rochester.edu', 8000);
//	//$cli->setDebug(1);
//	$resp = $cli->send($msg);
//	
//	echo '<pre>';
//	
//	if ($resp) {
//		if (!$resp->faultCode()) {
//			$val = $resp->value();
//			$data = XML_RPC_decode($val);
//			echo print_r($data);
//		} else {
//			/*
//			 * Display problems that have been gracefully cought and
//			 * reported by the xmlrpc.php script
//			 */
//			echo 'Fault Code: ' . $resp->faultCode() . "\n";
//			echo 'Fault Reason: ' . $resp->faultString() . "\n";
//		}	
//	} else {
//		echo '<p>Communication error: ' . $cli->errstr . '</p>';
//	}
//	
//	echo '</pre>';

/// First we check that form variables have been initialised
if (!isset($form->name)) {
	$form->name = '';
}
if( !isset($form->intro) ) {
	$form->intro = 'Introduction?? where is this used? defined in mod.html';
}
if( !isset($form->set_id) ) {
	$form->set_id = -1;
}
if( ! isset($form->gradingmethod) ) {
	$form->gradingmethod = 0;
}

// this is really hacky, but I need the contents of the lib.php for wwassignment:
require_once ("$CFG->dirroot/mod/wwassignment/lib.php");
define('WWASSIGNMENT_WEBWORK_URL', $CFG->wwassignment_webworkurl);

require_login($course->id);

add_to_log($course->id, "wwassignment", "view all", "index.php?id=$course->id", "");
$wwCourseName = _wwassignment_courseIdToShortName($course->id);

/// Get all required strings
$strwwassignments = get_string("modulenameplural", "wwassignment");
$strwwassignment  = get_string("modulename", "wwassignment");

// ensure that there is a bridge for this course
_wwassignment_ensureBridgeExists($course->id);

?>

<?php

if (isadmin() || isteacher($course->id)) {
	print "<p style='font-size: smaller; text-align: center;'>";
}
if (isadmin()) {
	print("<a href='".WWASSIGNMENT_WEBWORK_URL."/admin/?subDisplay=add_course&add_courseID=$wwCourseName&add_dbLayout=sql_moodle'>"."Create WeBWorK course"."</a>");
		
}
if (isadmin() && isteacher($course->id)) {
	print("<br/>");
}
if(isteacher($course->id)) {
	print("<a href='".WWASSIGNMENT_WEBWORK_URL."/$course->shortname/instructor' target='_blank'>"
	       .get_string("goToWeBWorK", "wwassignment")."</a>");
}
if (isadmin() || isteacher($course->id)) {
	print "</p>";
}

?>

	<form name="form" method="post" action="mod.php">
	<center>
	<table cellpadding="5">
	<tr valign="top">
		<td align="right"><label for='name'><b><?php  print_string("name") ?>:</b></label></td>
		<td>
			<input type="text" id='name' name="name" size="30" value="<?php	 p($form->name) ?>">
		</td>
	</tr>
	<!-- More rows go in here... -->
	
	<tr valign='top'>
		<td align='right'><label for='set_id'><b><?php print_string("set_id", "wwassignment"); ?>:</b></label><br />
			<?php helpbutton("set_id", get_string("helpSet_id", "wwassignment"), "wwassignment", true, true); ?>
		</td>
		<td align='left'><?php _wwassignment_printSetSelect($form->course, $form->set_id); ?></td>
	</tr>
	<tr valign="top">
		<td align="right"><b><?php print_string("description", "assignment") ?>:</b>
		 <br /><br />
		 <?php
			helpbutton("writing", get_string("helpwriting"), "moodle", true, true);
			echo "<br />";
			helpbutton("questions", get_string("helpquestions"), "moodle", true, true);
			echo "<br />";
			if ($usehtmleditor) {
			   helpbutton("richtext", get_string("helprichtext"), "moodle", true, true);
			} else {
			   emoticonhelpbutton("form", "description");
			} 
		  ?>
		</td>
		<td>
		<?php
		   print_textarea($usehtmleditor, 20, 60, 680, 400, "description", $form->description);
		
		   if ($usehtmleditor) {
			   echo '<input type="hidden" name="format" value="'.FORMAT_HTML.'" />';
		   } else {
			   echo '<div align="right">';
			   helpbutton("textformat", get_string("formattexttype"));
			   print_string("formattexttype");
			   echo ':&nbsp;';
			   if (!$form->format) {
				   $form->format = $defaultformat;
			   }
			   choose_from_menu(format_text_menu(), "format", $form->format, ""); 
			   echo '</div>';
		   }
		?>
		</td>
	</tr>
	<tr valign='top'>
		<td align='right'><label for='gradeMethod'><b><?php print_string("gradeMethod", "wwassignment"); ?>:</b></label><br />
			<?php helpbutton("gradeMethod", get_string("helpGradeMethod", "wwassignment"), "wwassignment", true, true); ?>
		</td>
		<td align='left'><?php wwassignment_printGradeMethodSelect($form->gradingmethod); ?></td>
	</tr>
	<!-- The following line for Moodle 1.5 prints the visibility setting form element -->
	<?php print_visible_setting($form,$oCourse); // the version without $oCourse doesn't work, error in course/lib.php perhaps MEG?>
	
	</table>
	<!-- These hidden variables are always the same -->
	<input type="hidden" name='formaction'	  value="create_assignment" />
	<input type="hidden" name='course'		  value="<?php	p($form->course) ?>" />
	<input type="hidden" name="sesskey"		  value="<?php	p($form->sesskey) ?>" />
	<input type="hidden" name='coursemodule'  value="<?php	p($form->coursemodule) ?>" />
	<input type="hidden" name='section'		  value="<?php	p($form->section) ?>" />
	<input type="hidden" name='module'		  value="<?php	p($form->module) ?>" />
	<input type="hidden" name='modulename'	  value="<?php	p($form->modulename) ?>" />
	<input type="hidden" name='instance'	  value="<?php	p($form->instance) ?>" />
	<input type="hidden" name='mode'		  value="<?php	p($form->mode) ?>" />
	<input type="submit" value="<?php  print_string("savechanges") ?>" />
	</center>
	
	</form>
