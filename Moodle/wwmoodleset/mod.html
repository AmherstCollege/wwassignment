<!-- This page defines the form to create or edit an instance of this module -->
<!-- It is used from /course/mod.php.  The whole instance is available as $form. -->

<?php

// $Id$
/// First we check that form variables have been initialised
if (!isset($form->name)) {
	$form->name = '';
}
if( !isset($form->intro) ) {
	$form->intro = '';
}
if( !isset($form->set_id) ) {
	$form->set_id = -1;
}
if( ! isset($form->gradeMethod) ) {
	$form->gradeMethod = 1;
}
    
    require_login($course->id);
    
    add_to_log($course->id, "wwmoodleset", "view all", "index.php?id=$course->id", "");

    define('WWMOODLE_SET_WEBWORK_URL', $CFG->wwmoodleset_webwork_url);
    
/// Get all required strings

    $strwwmoodlesets = get_string("modulenameplural", "wwmoodleset");
    $strwwmoodleset  = get_string("modulename", "wwmoodleset");


// ensure that there is a bridge for this course:
	$oCourse = get_record("course", "id", $form->course);
	
	$aMods = get_all_instances_in_course("wwmoodle", $oCourse);
	if( count($aMods) != 1 ) {
		print_simple_box(get_string("hasNoBridge", "wwmoodleset"), 'center', '', '#FFBBBB', 5, 'errorbox');
		print_footer();
		die;
	}
	
// this is really hacky, but I need the contents of the lib.php for wwmoodleset:
	require_once("../mod/wwmoodleset/lib.php"); 
	?>
	
	<form name="form" method="post" action="mod.php">
	<center>
	<table cellpadding="5">
	<tr valign="top">
		<td align="right"><label for='name'><b><?php  print_string("name") ?>:</b></label></td>
		<td>
			<input type="text" id='name' name="name" size="30" value="<?php  p($form->name) ?>">
		</td>
	</tr>
	<!-- More rows go in here... -->
	
	<tr valign='top'>
		<td align='right'><label for='set_id'><b><?php print_string("set_id", "wwmoodleset"); ?>:</b></label><br />
			<?php helpbutton("set_id", get_string("helpSet_id", "wwmoodleset"), "wwmoodleset", true, true); ?>
		</td>
		<td align='left'><?php wwmoodleset_printSetSelect($form->course, $form->set_id); ?></td>
	</tr>
	<tr valign="top">
		<td align="right"><b><?php print_string("description", "assignment") ?>:</b>
		 <br /><br />
		 <?php
			helpbutton("writing", get_string("helpwriting"), "moodle", true, true);
			echo "<br />";
			helpbutton("questions", get_string("helpquestions"), "moodle", true, true);
			echo "<br />";
			if ($usehtmleditor) {
			   helpbutton("richtext", get_string("helprichtext"), "moodle", true, true);
			} else {
			   emoticonhelpbutton("form", "description");
			} 
		  ?>
		</td>
		<td>
		<?php
		   print_textarea($usehtmleditor, 20, 60, 680, 400, "description", $form->description);
		
		   if ($usehtmleditor) {
			   echo '<input type="hidden" name="format" value="'.FORMAT_HTML.'" />';
		   } else {
			   echo '<div align="right">';
			   helpbutton("textformat", get_string("formattexttype"));
			   print_string("formattexttype");
			   echo ':&nbsp;';
			   if (!$form->format) {
				   $form->format = $defaultformat;
			   }
			   choose_from_menu(format_text_menu(), "format", $form->format, ""); 
			   echo '</div>';
		   }
		?>
		</td>
	</tr>
	<tr valign='top'>
		<td align='right'><label for='gradeMethod'><b><?php print_string("gradeMethod", "wwmoodleset"); ?>:</b></label><br />
			<?php helpbutton("gradeMethod", get_string("helpGradeMethod", "wwmoodleset"), "wwmoodleset", true, true); ?>
		</td>
		<td align='left'><?php wwmoodleset_printGradeMethodSelect($form->gradeMethod); ?></td>
	</tr>
	<!-- The following line for Moodle 1.5 prints the visibility setting form element -->
	<?php print_visible_setting($form,$oCourse); // the version without $oCourse doesn't work, error in course/lib.php perhaps MEG?>
	
	</table>
	<!-- These hidden variables are always the same -->
	<input type="hidden" name='course'        value="<?php  p($form->course) ?>" />
	<input type="hidden" name="sesskey"     value="<?php  p($form->sesskey) ?>" />
	<input type="hidden" name='coursemodule'  value="<?php  p($form->coursemodule) ?>" />
	<input type="hidden" name='section'       value="<?php  p($form->section) ?>" />
	<input type="hidden" name='module'        value="<?php  p($form->module) ?>" />
	<input type="hidden" name='modulename'    value="<?php  p($form->modulename) ?>" />
	<input type="hidden" name='instance'      value="<?php  p($form->instance) ?>" />
	<input type="hidden" name='mode'          value="<?php  p($form->mode) ?>" />
	<input type="submit" value="<?php  print_string("savechanges") ?>" />
	</center>
	
	</form>
	<?php
		if( isteacher($course->id) ) {
			print("<p style='font-size: smaller; color: #aaa; text-align: center;'>
			 <a style='color: #666;text-decoration:underline' href='".WWMOODLE_SET_WEBWORK_URL."/$course->shortname/instructor' target='_webwork_edit'>"
			 .get_string("goToWeBWorK", "wwmoodle")."</a></p>");
		}
	?>