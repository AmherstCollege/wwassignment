<!-- This page defines the form to create or edit an instance of this module -->
<!-- It is used from /course/mod.php.  The whole instance is available as $form. -->

<?php
// $Id$
/// First we check that form variables have been initialised
if (!isset($form->name)) {
		$form->name = '';
}
if( !isset($form->createWWc) ) {
	$form->createWWc = 1;
}
if( !isset($form->allowedRecipients) ) {
	$form->allowedRecipients = "";
}
if( !isset($form->visible) ) {
	$form->visible = "0";
}

// ensure there is not already a wwmoodle for this course (unless we're editing the existing bridge)
if( empty($form->instance) ) {
	$oCourse = get_record("course", "id", $form->course);
	$aMods = get_all_instances_in_course("wwmoodle", $oCourse);
	if( count($aMods) > 0 ) {
		print_simple_box(get_string("alreadyHasBridge", "wwmoodle"), 'center', '', '#FFBBBB', 5, 'errorbox');
		print_footer();
		die;
	}
}

?>

<form name="form" method="post" action="mod.php">
<center>
<table cellpadding="5">
<tr valign="top">
		<td align="right"><label for='name'><b><?php  print_string("name") ?>:</b></label></td>
		<td>
				<input type="text" id='name' name="name" size="30" value="<?php  p($form->name) ?>">
		</td>
</tr>
<?php
// only give the option to create the WeBWorK course it they're adding for the first time.
if( empty($form->instance) ) { ?>
<tr valign='top'>
	<td align='right'><label for='createWWc'><b><?php print_string("createWWc", "wwmoodle"); ?>:</b></label><br />
		<?php helpbutton("createWWc", get_string("helpCreateWWc", "wwmoodle"), "wwmoodle", true, true); ?>
	</td>
	<td align='left'><input type='checkbox' id='createWWc' name='createWWc' <?php if( $form->createWWc ) print("checked='checked'"); ?> /></td>
</tr>
<?php
}
?>
<tr valign='top'>
	<td align='right'><label for='allowedRecipients'><b><?php print_string("allowedRecipients", "wwmoodle"); ?>:</b></label><br />
		<?php helpbutton("allowedRecipients", get_string("helpAllowedRecipients", "wwmoodle"), "wwmoodle", true, true); ?>
	</td>
	<td align='left'><input type='text' id='allowedRecipients' name='allowedRecipients' value='<?php p($form->allowedRecipients); ?>' /></td>
</tr>
<!-- More rows go in here... -->

<!-- The following line for Moodle 1.5 prints the visibility setting form element -->
<?php print_visible_setting($form); ?>

</table>
<!-- These hidden variables are always the same -->
<input type="hidden" name='course'        value="<?php  p($form->course) ?>" />
<input type="hidden" name="sesskey"     value="<?php  p($form->sesskey) ?>" />
<input type="hidden" name='coursemodule'  value="<?php  p($form->coursemodule) ?>" />
<input type="hidden" name='section'       value="<?php  p($form->section) ?>" />
<input type="hidden" name='module'        value="<?php  p($form->module) ?>" />
<input type="hidden" name='modulename'    value="<?php  p($form->modulename) ?>" />
<input type="hidden" name='instance'      value="<?php  p($form->instance) ?>" />
<input type="hidden" name='mode'          value="<?php  p($form->mode) ?>" />
<input type="submit" value="<?php  print_string("savechanges") ?>" />
</center>

</form>
